<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>注文ページ</title>

  <!-- ▼ Google翻訳ウィジェットの呼び出しスクリプト -->
  <script type="text/javascript">
    // Google翻訳がページ読み込み時に呼び出す関数
    function googleTranslateElementInit() {
      new google.translate.TranslateElement(
        {
          pageLanguage: 'ja',
          // 必要に応じて表示したい言語をカンマ区切りで指定（以下は例）
          // 指定しなければ全言語が自動で表示されます
          includedLanguages: 'ja,en,zh-CN,zh-TW,ko,uz,fr,es,de,it,pt,ru',
          layout: google.translate.TranslateElement.InlineLayout.SIMPLE
        },
        'google_translate_element'
      );
    }
  </script>
  <!-- Google翻訳のメインスクリプト: ローカル環境では動作しません -->
  <script type="text/javascript" src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>
  <!-- ▲ Google翻訳ウィジェットの呼び出しスクリプト -->

  <style>
    html, body {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      background-color: #f9f9f9;
      color: #333;
    }
    *, *::before, *::after {
      box-sizing: inherit;
    }
    .page-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }
    .container {
      display: flex;
      gap: 20px;
    }
    .left {
      flex: 1;
    }
    .right {
      width: 350px;
      background-color: #fff;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      padding: 20px;
    }
    h1 {
      text-align: center;
      margin-bottom: 30px;
      font-size: 1.8rem;
      font-weight: 600;
      color: #444;
    }
    h2, h3, h4 {
      margin-bottom: 10px;
      font-weight: 600;
      color: #444;
    }
    p {
      margin-bottom: 8px;
      font-size: 0.95rem;
    }

    /* タブメニュー */
    .tab-menu {
      list-style: none;
      display: flex;
      margin: 0 0 20px;
      padding: 0;
      border-bottom: 1px solid #ccc;
      background-color: #fff;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 1px 4px rgba(0,0,0,0.1);
    }
    .tab-menu li {
      flex: 1;
      text-align: center;
      padding: 12px 0;
      cursor: pointer;
      transition: background-color 0.3s, color 0.3s;
      font-size: 0.95rem;
      font-weight: 500;
      color: #555;
      border-right: 1px solid #eee;
    }
    .tab-menu li:last-child {
      border-right: none;
    }
    .tab-menu li:hover {
      background-color: #f0f0f0;
    }
    .tab-menu li.active {
      background-color: #4aa7d0;
      color: #fff;
    }

    /* タブコンテンツ */
    .tab-content {
      display: none;
      background-color: #fff;
      border-radius: 8px;
      box-shadow: 0 1px 4px rgba(0,0,0,0.1);
      padding: 20px;
      margin-bottom: 20px;
    }
    .tab-content.active {
      display: block;
    }

    /* 商品画像 */
    .product-sample-image {
      max-width: 280px;
      height: auto;
      display: block;
      margin-bottom: 15px;
      border-radius: 4px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }

    /* メニュー（段）のレイアウト */
    .menu-row {
      display: flex;
      gap: 10px;
      margin-bottom: 15px;
      flex-wrap: wrap;
    }
    button {
      padding: 10px 14px;
      border: 1px solid #ccc;
      background: #fff;
      cursor: pointer;
      border-radius: 4px;
      font-size: 0.9rem;
      transition: background-color 0.2s, box-shadow 0.2s;
    }
    button:hover {
      background-color: #f4f4f4;
      box-shadow: 0 0 3px rgba(0,0,0,0.1);
    }
    .active-btn {
      background-color: #4aa7d0;
      color: #fff;
      border-color: #4aa7d0;
    }

    /* 右カラム */
    #cart-list {
      list-style: none;
      padding-left: 0;
      margin: 0;
    }
    #cart-list li {
      margin-bottom: 6px;
      line-height: 1.4;
      font-size: 0.9rem;
    }
    .cart-total {
      margin-top: 16px;
      font-weight: bold;
      color: #333;
    }
    #discount-info {
      margin-top: 8px;
      font-size: 0.95rem;
      line-height: 1.4;
    }
    #json-preview {
      white-space: pre-wrap;
      background: #f7f7f7;
      border: 1px solid #ccc;
      padding: 10px;
      margin-top: 10px;
      font-size: 0.85rem;
      border-radius: 4px;
      color: #555;
      max-height: 250px;
      overflow: auto;
    }
    #order-total {
      margin-top: 12px;
      font-weight: 600;
      color: #333;
    }
    #add-cart-btn {
      display: inline-block;
      margin: 14px 0;
      padding: 10px 16px;
      background-color: #4aa7d0;
      color: #fff;
      border: none;
      border-radius: 4px;
      font-size: 0.9rem;
      cursor: pointer;
      transition: background-color 0.2s, box-shadow 0.2s;
    }
    #add-cart-btn:hover {
      background-color: #4092b9;
      box-shadow: 0 1px 3px rgba(0,0,0,0.15);
    }

    /* 段の初期は非表示 */
    #row1-display, #row2-display, #row3-display, #row4-display {
      display: none;
    }
  </style>
</head>
<body>

  <!-- ▼ Google翻訳の言語選択プルダウンを表示するための領域 -->
  <div id="google_translate_element" style="text-align: right; padding: 10px;"></div>
  <!-- ▲ Google翻訳の言語選択プルダウン -->

  <div class="page-container">
    <h1>注文ページ</h1>

    <div class="container">
      <!-- 左カラム：タブ＆商品選択 -->
      <div class="left">
        <ul class="tab-menu" id="tab-menu">
          <li class="active" data-tab="wrap">ラップ</li>
          <li data-tab="sand">サンド</li>
          <li data-tab="rice">ライス</li>
          <li data-tab="cup">カップ</li>
          <li data-tab="limited">期間限定</li>
          <li data-tab="drink">ドリンク</li>
          <li data-tab="snack">スナック</li>
        </ul>

        <!-- ラップ -->
        <div class="tab-content active" id="wrap">
          <img class="product-sample-image"
               src="https://via.placeholder.com/300?text=Wrap" alt="ラップ" />
          <div class="menu-row" data-row="row1">
            <button>和牛</button>
            <button>ビーフ</button>
            <button>チキン</button>
            <button>ミックス</button>
          </div>
          <div class="menu-row" data-row="row2">
            <button>大もり</button>
            <button>並もり</button>
            <button>超特大</button>
          </div>
          <div class="menu-row" data-row="row3">
            <button>テリヤキ</button>
            <button>甘口</button>
            <button>スーパーガーリック</button>
            <button>中辛</button>
            <button>辛口</button>
            <button>激辛</button>
          </div>
          <div class="menu-row" data-row="row4">
            <button>明太マヨ</button>
            <button>スイートチリ</button>
            <button>ダブルチーズ</button>
            <button>カレー</button>
          </div>
        </div>

        <!-- サンド -->
        <div class="tab-content" id="sand">
          <img class="product-sample-image"
               src="https://via.placeholder.com/300?text=Sand" alt="サンド" />
          <div class="menu-row" data-row="row1">
            <button>和牛</button>
            <button>ビーフ</button>
            <button>チキン</button>
            <button>ミックス</button>
          </div>
          <div class="menu-row" data-row="row2">
            <button>大もり</button>
            <button>並もり</button>
            <button>超特大</button>
          </div>
          <div class="menu-row" data-row="row3">
            <button>テリヤキ</button>
            <button>甘口</button>
            <button>スーパーガーリック</button>
            <button>中辛</button>
            <button>辛口</button>
            <button>激辛</button>
          </div>
          <div class="menu-row" data-row="row4">
            <button>明太マヨ</button>
            <button>スイートチリ</button>
            <button>ダブルチーズ</button>
            <button>カレー</button>
          </div>
        </div>

        <!-- ライス -->
        <div class="tab-content" id="rice">
          <img class="product-sample-image"
               src="https://via.placeholder.com/300?text=Rice" alt="ライス" />
          <div class="menu-row" data-row="row1">
            <button>和牛</button>
            <button>ビーフ</button>
            <button>チキン</button>
            <button>ミックス</button>
          </div>
          <div class="menu-row" data-row="row2">
            <button>大もり</button>
            <button>並もり</button>
            <button>超特大</button>
          </div>
          <div class="menu-row" data-row="row3">
            <button>テリヤキ</button>
            <button>甘口</button>
            <button>スーパーガーリック</button>
            <button>中辛</button>
            <button>辛口</button>
            <button>激辛</button>
          </div>
          <div class="menu-row" data-row="row4">
            <button>明太マヨ</button>
            <button>スイートチリ</button>
            <button>ダブルチーズ</button>
            <button>カレー</button>
          </div>
        </div>

        <!-- カップ -->
        <div class="tab-content" id="cup">
          <img class="product-sample-image"
               src="https://via.placeholder.com/300?text=Cup" alt="カップ" />
          <div class="menu-row" data-row="row1">
            <button>和牛</button>
            <button>ビーフ</button>
            <button>チキン</button>
            <button>ミックス</button>
          </div>
          <div class="menu-row" data-row="row2">
            <button>大もり</button>
            <button>並もり</button>
            <button>超特大</button>
          </div>
          <div class="menu-row" data-row="row3">
            <button>テリヤキ</button>
            <button>甘口</button>
            <button>スーパーガーリック</button>
            <button>中辛</button>
            <button>辛口</button>
            <button>激辛</button>
          </div>
          <div class="menu-row" data-row="row4">
            <button>明太マヨ</button>
            <button>スイートチリ</button>
            <button>ダブルチーズ</button>
            <button>カレー</button>
          </div>
        </div>

        <!-- 期間限定 -->
        <div class="tab-content" id="limited">
          <img class="product-sample-image"
               src="https://via.placeholder.com/300?text=Limited" alt="期間限定" />
          <div class="menu-row" data-row="row1">
            <button>キムチサンド</button>
            <button>トムヤムロール</button>
            <button>クリームシチューカップ</button>
          </div>
        </div>

        <!-- ドリンク -->
        <div class="tab-content" id="drink">
          <img class="product-sample-image"
               src="https://via.placeholder.com/300?text=Drink" alt="ドリンク" />
          <div class="menu-row" data-row="row1">
            <button>コーラ</button>
            <button>フレッシュオレンジ</button>
            <button>ミネラルウォーター</button>
          </div>
        </div>

        <!-- スナック -->
        <div class="tab-content" id="snack">
          <img class="product-sample-image"
               src="https://via.placeholder.com/300?text=Snack" alt="スナック" />
          <div class="menu-row" data-row="row1">
            <button>ポテト</button>
            <button>ポテトチップス</button>
          </div>
        </div>
      </div><!-- left -->

      <!-- 右カラム -->
      <div class="right">
        <h2>注文内容</h2>
        <p>メニュー: <span id="order-base">ラップ</span></p>
        <p id="row1-display">1段目: <span id="order-row1"></span></p>
        <p id="row2-display">2段目: <span id="order-row2"></span></p>
        <p id="row3-display">3段目: <span id="order-row3"></span></p>
        <p id="row4-display">4段目: <span id="order-row4"></span></p>
        <p id="order-total">合計: ¥0</p>

        <button id="add-cart-btn">カートに追加</button>

        <h3>カート</h3>
        <ul id="cart-list"></ul>
        <div id="cart-total" class="cart-total">カート合計: ¥0</div>
        <div id="discount-info"></div>

        <h4>JSONプレビュー</h4>
        <div id="json-preview"></div>
      </div><!-- right -->
    </div><!-- container -->
  </div><!-- page-container -->

  <script>
    // 価格データ
    const priceData = {
      "ラップ": 200, "サンド": 300, "ライス": 400, "カップ": 100,
      "和牛": 1500, "ビーフ": 600, "チキン": 400, "ミックス": 500,
      "大もり": 300, "並もり": 200, "超特大": 500,
      "テリヤキ": 100, "甘口": 0, "スーパーガーリック": 0, "中辛": 0, "辛口": 0, "激辛": 100,
      "明太マヨ": 100, "スイートチリ": 200, "ダブルチーズ": 300, "カレー": 100,
      "キムチサンド": 800, "トムヤムロール": 800, "クリームシチューカップ": 900,
      "コーラ": 200, "フレッシュオレンジ": 300, "ミネラルウォーター": 150,
      "ポテト": 300, "ポテトチップス": 250
    };

    function convertTabIdToLabel(tabId) {
      switch(tabId) {
        case 'wrap':    return 'ラップ';
        case 'sand':    return 'サンド';
        case 'rice':    return 'ライス';
        case 'cup':     return 'カップ';
        case 'limited': return '期間限定';
        case 'drink':   return 'ドリンク';
        case 'snack':   return 'スナック';
        default:        return tabId;
      }
    }

    // 各タブの選択状態
    const menuStates = {
      wrap:    { row1: '', row2: '', row3: '', row4: [] },
      sand:    { row1: '', row2: '', row3: '', row4: [] },
      rice:    { row1: '', row2: '', row3: '', row4: [] },
      cup:     { row1: '', row2: '', row3: '', row4: [] },
      limited: { row1: '', row2: '', row3: '', row4: [] },
      drink:   { row1: '', row2: '', row3: '', row4: [] },
      snack:   { row1: '', row2: '', row3: '', row4: [] }
    };
    let currentTab = 'wrap';
    let cart = [];

    // タブ切り替え
    const tabMenuItems = document.querySelectorAll('.tab-menu li');
    const tabContents = document.querySelectorAll('.tab-content');
    tabMenuItems.forEach(item => {
      item.addEventListener('click', () => {
        tabMenuItems.forEach(i => i.classList.remove('active'));
        tabContents.forEach(c => c.classList.remove('active'));
        item.classList.add('active');
        const newTabId = item.getAttribute('data-tab');

        // 新タブは未選択状態にリセット
        menuStates[newTabId] = { row1: '', row2: '', row3: '', row4: [] };

        document.getElementById(newTabId).classList.add('active');
        currentTab = newTabId;
        loadTabStateToUI(currentTab);
      });
    });

    // ボタンで row を更新
    const allMenuButtons = document.querySelectorAll('.menu-row button');
    allMenuButtons.forEach(button => {
      button.addEventListener('click', () => {
        const row = button.closest('.menu-row').getAttribute('data-row');
        const value = button.textContent;

        if (row === 'row4') {
          // 複数選択
          const arr = menuStates[currentTab].row4;
          const idx = arr.indexOf(value);
          if (idx === -1) {
            arr.push(value);
            button.classList.add('active-btn');
          } else {
            arr.splice(idx, 1);
            button.classList.remove('active-btn');
          }
        } else {
          // 単一選択
          menuStates[currentTab][row] = value;
          const siblings = button.closest('.menu-row').querySelectorAll('button');
          siblings.forEach(btn => btn.classList.remove('active-btn'));
          button.classList.add('active-btn');
        }

        updateSummary();
      });
    });

    // UI反映
    function loadTabStateToUI(tabId) {
      // 全ボタンハイライト解除
      allMenuButtons.forEach(btn => btn.classList.remove('active-btn'));

      const state = menuStates[tabId];
      ['row1','row2','row3'].forEach(rowKey => {
        const val = state[rowKey];
        if (!val) return;
        const rowDiv = document
          .getElementById(tabId)
          .querySelector(`.menu-row[data-row="${rowKey}"]`);
        if (!rowDiv) return;
        const targetBtn = Array.from(rowDiv.querySelectorAll('button'))
          .find(b => b.textContent === val);
        if (targetBtn) {
          targetBtn.classList.add('active-btn');
        }
      });
      // row4
      state.row4.forEach(tp => {
        const rowDiv = document
          .getElementById(tabId)
          .querySelector(`.menu-row[data-row="row4"]`);
        if (!rowDiv) return;
        const targetBtn = Array.from(rowDiv.querySelectorAll('button'))
          .find(b => b.textContent === tp);
        if (targetBtn) {
          targetBtn.classList.add('active-btn');
        }
      });

      updateSummary();
    }

    // 右カラム (未選択行は非表示) + 価格
    function updateSummary() {
      const state = menuStates[currentTab];
      const baseLabel = convertTabIdToLabel(currentTab);

      const basePrice = priceData[baseLabel] || 0;
      const row1Price = state.row1 ? (priceData[state.row1] || 0) : 0;
      const row2Price = state.row2 ? (priceData[state.row2] || 0) : 0;
      const row3Price = state.row3 ? (priceData[state.row3] || 0) : 0;
      let toppingsPrice = 0;
      state.row4.forEach(tp => toppingsPrice += priceData[tp] || 0);

      const total = basePrice + row1Price + row2Price + row3Price + toppingsPrice;

      document.getElementById('order-base').textContent =
        `${baseLabel} (¥${basePrice})`;

      // row1
      if (state.row1) {
        document.getElementById('row1-display').style.display = 'block';
        document.getElementById('order-row1').textContent =
          `${state.row1} (¥${row1Price})`;
      } else {
        document.getElementById('row1-display').style.display = 'none';
      }

      // row2
      if (state.row2) {
        document.getElementById('row2-display').style.display = 'block';
        document.getElementById('order-row2').textContent =
          `${state.row2} (¥${row2Price})`;
      } else {
        document.getElementById('row2-display').style.display = 'none';
      }

      // row3
      if (state.row3) {
        document.getElementById('row3-display').style.display = 'block';
        document.getElementById('order-row3').textContent =
          `${state.row3} (¥${row3Price})`;
      } else {
        document.getElementById('row3-display').style.display = 'none';
      }

      // row4
      if (state.row4.length > 0) {
        document.getElementById('row4-display').style.display = 'block';
        const row4Text = state.row4.map(tp => {
          const p = priceData[tp] || 0;
          return `${tp} (¥${p})`;
        }).join(', ');
        document.getElementById('order-row4').textContent = row4Text;
      } else {
        document.getElementById('row4-display').style.display = 'none';
      }

      document.getElementById('order-total').textContent = `合計: ¥${total}`;
    }

    // 「カートに追加」ボタン
    document.getElementById('add-cart-btn').addEventListener('click', () => {
      // ラップ/サンド/ライス/カップ は1～3段目必須
      if (['wrap','sand','rice','cup'].includes(currentTab)) {
        const st = menuStates[currentTab];
        if (!st.row1 || !st.row2 || !st.row3) {
          alert('1～3段目が未選択です。すべて選択してください。');
          return;
        }
      }

      const st = menuStates[currentTab];
      const baseLabel = convertTabIdToLabel(currentTab);
      const basePrice = priceData[baseLabel] || 0;
      const row1Price = st.row1 ? (priceData[st.row1] || 0) : 0;
      const row2Price = st.row2 ? (priceData[st.row2] || 0) : 0;
      const row3Price = st.row3 ? (priceData[st.row3] || 0) : 0;
      let toppingsPrice = 0;
      st.row4.forEach(tp => toppingsPrice += priceData[tp] || 0);
      const total = basePrice + row1Price + row2Price + row3Price + toppingsPrice;

      const cartItem = {
        base: baseLabel,
        basePrice,
        row1: st.row1 || '未選択',
        row1Price,
        row2: st.row2 || '未選択',
        row2Price,
        row3: st.row3 || '未選択',
        row3Price,
        row4: st.row4.length ? st.row4 : ['未選択'],
        row4Price: toppingsPrice,
        totalPrice: total
      };
      cart.push(cartItem);
      updateCart();
    });

    // カート表示
    function updateCart() {
      const cartList = document.getElementById('cart-list');
      cartList.innerHTML = '';
      let grandTotal = 0;

      cart.forEach((item, idx) => {
        const tStr = item.row4.join(', ');
        const li = document.createElement('li');
        li.textContent =
          `${idx+1}. `
          + `[${item.base}(¥${item.basePrice})] `
          + `[${item.row1}(¥${item.row1Price})] `
          + `[${item.row2}(¥${item.row2Price})] `
          + `[${item.row3}(¥${item.row3Price})] `
          + `[${tStr}(¥${item.row4Price})] `
          + `合計: ¥${item.totalPrice}`;
        cartList.appendChild(li);
        grandTotal += item.totalPrice;
      });

      document.getElementById('cart-total').textContent = `カート合計: ¥${grandTotal}`;

      // --- 割引計算 ---
      let discountRate = 0;
      let discountCondition = '割引なし';
      if (grandTotal >= 4000) {
        discountRate = 0.20;
        discountCondition = '4,000円以上で20％引き';
      } else if (grandTotal >= 3000) {
        discountRate = 0.15;
        discountCondition = '3,000円以上で15％引き';
      } else if (grandTotal >= 2000) {
        discountRate = 0.10;
        discountCondition = '2,000円以上で10％引き';
      } else if (grandTotal >= 1000) {
        discountRate = 0.05;
        discountCondition = '1,000円以上で5％引き';
      }

      const discountAmount = Math.floor(grandTotal * discountRate);
      const finalPrice = grandTotal - discountAmount;
      // 消費税10%加算 (割引後の価格に対して)
      const finalPriceWithTax = Math.floor(finalPrice * 1.1);

      // 表示
      const discountInfo = document.getElementById('discount-info');
      if (discountRate > 0) {
        discountInfo.innerHTML = `
         （${discountCondition}）<br/>
          割引金額: ¥${discountAmount}<br/>
          割引適用後の価格: ¥${finalPrice}<br/>
         
          <strong>支払い総額(税込10％): ¥${finalPriceWithTax}</strong>
        `;
      } else {
        discountInfo.innerHTML = `
          割引金額: ¥0<br/>
          割引適用後の価格: ¥${grandTotal}<br/>
          （${discountCondition}）<br/>
          <strong>支払い総額(税込10％): ¥${Math.floor(grandTotal * 1.1)}</strong>
        `;
      }

      // JSON出力
      const cartSummary = {
        items: cart,
        cartTotal: grandTotal,
        discountRate,
        discountAmount,
        finalPrice,
        discountCondition,
        finalPriceWithTax: finalPriceWithTax
      };
      const jsonStr = JSON.stringify(cartSummary, null, 2);
      document.getElementById('json-preview').textContent = jsonStr;
    }

    // 初期読み込み
    loadTabStateToUI(currentTab);
  </script>

</body>
</html>
